# üîÑ Workflow Builder Sistemi

Bu dok√ºmantasyon, Hizmet ERP sistemi i√ßin geli≈ütirilen g√∂rsel i≈ü akƒ±≈üƒ± olu≈üturucu hakkƒ±nda detaylƒ± bilgi i√ßermektedir.

## üìã ƒ∞√ßindekiler

1. [Genel Bakƒ±≈ü](#genel-bakƒ±≈ü)
2. [√ñzellikler](#√∂zellikler)
3. [Kurulum](#kurulum)
4. [Kullanƒ±m](#kullanƒ±m)
5. [Teknik Detaylar](#teknik-detaylar)
6. [API Referansƒ±](#api-referansƒ±)
7. [√ñrnekler](#√∂rnekler)

---

## üéØ Genel Bakƒ±≈ü

Workflow Builder, kullanƒ±cƒ±larƒ±n s√ºr√ºkle-bƒ±rak aray√ºz√º ile karma≈üƒ±k i≈ü akƒ±≈ülarƒ±nƒ± g√∂rsel olarak tasarlayabilecekleri g√º√ßl√º bir ara√ßtƒ±r. Bu sistem, talep y√∂netimi, onay s√ºre√ßleri, otomatik atamalar ve bildirimler gibi i≈ü s√ºre√ßlerini otomatikle≈ütirmek i√ßin kullanƒ±lƒ±r.

### üé® Aray√ºz √ñzellikleri

- **G√∂rsel Tasarƒ±m**: S√ºr√ºkle-bƒ±rak ile kolay tasarƒ±m
- **Node-Based System**: Baƒülantƒ±lƒ± d√ºƒü√ºm sistemi
- **Real-time Preview**: Canlƒ± √∂nizleme
- **Zoom & Pan**: Yakƒ±nla≈ütƒ±rma ve kaydƒ±rma
- **Grid Snapping**: Izgara hizalama
- **Undo/Redo**: Geri alma/tekrarlama

---

## üöÄ √ñzellikler

### üìä Node Tipleri

#### **1. Tetikleyici (Trigger)**
- **Talep Olu≈üturuldu**: Yeni talep eklendiƒüinde
- **Durum Deƒüi≈üti**: Talep durumu g√ºncellendiƒüinde
- **√ñncelik G√ºncellendi**: √ñncelik deƒüi≈ütiƒüinde
- **Zaman Bazlƒ±**: Belirli zamanlarda
- **√ñzel Tetikleyici**: API √ßaƒürƒ±sƒ± ile

#### **2. Ko≈üul (Condition)**
- **Mantƒ±ksal Operat√∂rler**: AND, OR, NOT
- **Kar≈üƒ±la≈ütƒ±rma**: ==, !=, >, <, >=, <=
- **Dizi Kontrol√º**: IN, NOT IN, CONTAINS
- **Regex E≈üle≈ütirme**: D√ºzenli ifade kontrol√º

#### **3. Aksiyon (Action)**
- **E-posta G√∂nder**: Otomatik e-posta bildirimi
- **Talep Ata**: Otomatik temsilci atama
- **Durum G√ºncelle**: Talep durumunu deƒüi≈ütir
- **G√∂rev Olu≈ütur**: Yeni g√∂rev ekle
- **Y√ºkselt**: √úst y√∂neticiye y√∂nlendir
- **Webhook**: Dƒ±≈ü sisteme bildirim g√∂nder

#### **4. Onay (Approval)**
- **Tek Onay**: Tek ki≈üiden onay
- **Sƒ±ralƒ± Onay**: Belirli sƒ±rayla onay
- **Paralel Onay**: Aynƒ± anda birden fazla onay
- **Ko≈üullu Onay**: Belirli ko≈üullara g√∂re onay

#### **5. Bildirim (Notification)**
- **E-posta Bildirimi**: Otomatik e-posta
- **SMS Bildirimi**: Mobil mesaj
- **Push Notification**: Anlƒ±k bildirim
- **Slack/Teams**: Kurumsal mesajla≈üma

### üîß Geli≈ümi≈ü √ñzellikler

#### **≈ûablon Sistemi**
- Hazƒ±r ≈üablonlar
- √ñzelle≈ütirilebilir ≈üablonlar
- ≈ûablon payla≈üƒ±mƒ±
- ≈ûablon kategorileri

#### **Deƒüi≈üken Sistemi**
- Global deƒüi≈ükenler
- Workflow deƒüi≈ükenleri
- Dinamik deƒüerler
- Ko≈üullu deƒüi≈ükenler

#### **ƒ∞zin Sistemi**
- Rol bazlƒ± eri≈üim
- Workflow izinleri
- D√ºzenleme izinleri
- √áalƒ±≈ütƒ±rma izinleri

---

## üõ†Ô∏è Kurulum

### 1. Veritabanƒ± Migration'ƒ±

#### Y√∂ntem 1: Node.js Script
```bash
# Environment variables'larƒ± ayarlayƒ±n
export VITE_SUPABASE_URL="your-supabase-url"
export SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"

# Migration'ƒ± √ßalƒ±≈ütƒ±rƒ±n
npm run workflow-migration
```

#### Y√∂ntem 2: Supabase Dashboard
1. Supabase Dashboard'a giri≈ü yapƒ±n
2. SQL Editor'√º a√ßƒ±n
3. `supabase/migrations/20241201_workflow_builder.sql` dosyasƒ±nƒ±n i√ßeriƒüini kopyalayƒ±n
4. SQL Editor'de √ßalƒ±≈ütƒ±rƒ±n

### 2. Uygulamayƒ± Ba≈ülatma
```bash
npm run dev
```

### 3. Eri≈üim
- Sidebar'dan "Workflow Builder" se√ßin
- Veya `/workflow-builder` URL'ine gidin

---

## üìñ Kullanƒ±m

### üé® Workflow Olu≈üturma

#### 1. Yeni Workflow
```typescript
// Yeni workflow olu≈ütur
const newWorkflow: Workflow = {
  name: 'Otomatik Talep Atama',
  description: 'Yeni talepleri otomatik olarak uygun temsilciye atar',
  category: 'ticket',
  status: 'draft',
  workflow_data: {
    nodes: [],
    connections: []
  },
  trigger_config: {},
  variables: {},
  version: 1,
  execution_count: 0
};
```

#### 2. Node Ekleme
```typescript
// Node ekle
const newNode: WorkflowNode = {
  id: `node_${Date.now()}`,
  type: 'trigger',
  position: { x: 100, y: 100 },
  data: {
    label: 'Talep Olu≈üturuldu',
    config: {
      conditions: {
        category: 'technical'
      }
    }
  }
};
```

#### 3. Baƒülantƒ± Olu≈üturma
```typescript
// Baƒülantƒ± olu≈ütur
const newConnection: WorkflowConnection = {
  id: `conn_${Date.now()}`,
  source: 'trigger_node_id',
  target: 'action_node_id'
};
```

### üîÑ Workflow √áalƒ±≈ütƒ±rma

#### 1. Manuel √áalƒ±≈ütƒ±rma
```typescript
// Workflow'u manuel olarak √ßalƒ±≈ütƒ±r
const executeWorkflow = async (workflowId: string, triggerData: any) => {
  const { data, error } = await supabase
    .from('workflow_executions')
    .insert([{
      workflow_id: workflowId,
      trigger_data: triggerData,
      status: 'running'
    }]);
};
```

#### 2. Otomatik Tetikleme
```typescript
// Talep olu≈üturulduƒüunda workflow tetikle
const triggerWorkflow = async (ticketData: any) => {
  const workflows = await getActiveWorkflows('ticket_created');
  
  for (const workflow of workflows) {
    if (matchesTriggerConditions(workflow, ticketData)) {
      await executeWorkflow(workflow.id, ticketData);
    }
  }
};
```

---

## üóÑÔ∏è Teknik Detaylar

### Veritabanƒ± Yapƒ±sƒ±

#### **workflows Tablosu**
```sql
CREATE TABLE workflows (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  category text NOT NULL DEFAULT 'ticket',
  status text DEFAULT 'draft',
  version integer DEFAULT 1,
  workflow_data jsonb NOT NULL DEFAULT '{}',
  trigger_config jsonb NOT NULL DEFAULT '{}',
  variables jsonb DEFAULT '{}',
  execution_count integer DEFAULT 0,
  last_executed timestamptz,
  created_by uuid,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

#### **workflow_executions Tablosu**
```sql
CREATE TABLE workflow_executions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  workflow_id uuid REFERENCES workflows(id) ON DELETE CASCADE,
  trigger_data jsonb NOT NULL DEFAULT '{}',
  execution_path jsonb NOT NULL DEFAULT '[]',
  status text DEFAULT 'running',
  start_time timestamptz DEFAULT now(),
  end_time timestamptz,
  error_message text,
  variables jsonb DEFAULT '{}',
  created_at timestamptz DEFAULT now()
);
```

### Bile≈üen Yapƒ±sƒ±

#### **Ana Bile≈üenler**
- `WorkflowBuilder`: Ana bile≈üen
- `WorkflowCanvas`: Canvas alanƒ±
- `NodePalette`: Node tipleri paleti
- `PropertiesPanel`: √ñzellikler paneli
- `TemplateModal`: ≈ûablon modal'ƒ±

#### **Hook'lar**
- `useWorkflow`: Workflow state y√∂netimi
- `useWorkflowExecution`: √áalƒ±≈ütƒ±rma y√∂netimi
- `useWorkflowTemplates`: ≈ûablon y√∂netimi

---

## üîå API Referansƒ±

### Workflow CRUD ƒ∞≈ülemleri

#### **Workflow Olu≈üturma**
```typescript
const createWorkflow = async (workflow: Workflow) => {
  const { data, error } = await supabase
    .from('workflows')
    .insert([workflow]);
  return { data, error };
};
```

#### **Workflow G√ºncelleme**
```typescript
const updateWorkflow = async (id: string, updates: Partial<Workflow>) => {
  const { data, error } = await supabase
    .from('workflows')
    .update(updates)
    .eq('id', id);
  return { data, error };
};
```

#### **Workflow Silme**
```typescript
const deleteWorkflow = async (id: string) => {
  const { error } = await supabase
    .from('workflows')
    .delete()
    .eq('id', id);
  return { error };
};
```

### Workflow √áalƒ±≈ütƒ±rma

#### **Workflow Tetikleme**
```typescript
const triggerWorkflow = async (workflowId: string, triggerData: any) => {
  const { data, error } = await supabase
    .from('workflow_executions')
    .insert([{
      workflow_id: workflowId,
      trigger_data: triggerData,
      status: 'running'
    }]);
  return { data, error };
};
```

#### **√áalƒ±≈ütƒ±rma Durumu Kontrol√º**
```typescript
const getExecutionStatus = async (executionId: string) => {
  const { data, error } = await supabase
    .from('workflow_executions')
    .select('*')
    .eq('id', executionId)
    .single();
  return { data, error };
};
```

---

## üìù √ñrnekler

### √ñrnek 1: Otomatik Talep Atama

```json
{
  "name": "Otomatik Talep Atama",
  "description": "Yeni talepleri otomatik olarak uygun temsilciye atar",
  "category": "ticket",
  "workflow_data": {
    "nodes": [
      {
        "id": "trigger_1",
        "type": "trigger",
        "position": { "x": 100, "y": 100 },
        "data": {
          "label": "Talep Olu≈üturuldu",
          "config": {
            "type": "ticket_created",
            "conditions": {
              "category": "technical"
            }
          }
        }
      },
      {
        "id": "action_1",
        "type": "action",
        "position": { "x": 400, "y": 100 },
        "data": {
          "label": "Temsilciye Ata",
          "config": {
            "type": "assign_ticket",
            "assignment_type": "skill_based",
            "skills": ["technical_support"]
          }
        }
      }
    ],
    "connections": [
      {
        "id": "conn_1",
        "source": "trigger_1",
        "target": "action_1"
      }
    ]
  }
}
```

### √ñrnek 2: SLA ƒ∞hlali Y√ºkseltme

```json
{
  "name": "SLA ƒ∞hlali Y√ºkseltme",
  "description": "SLA ihlali durumunda talebi y√ºkseltir",
  "category": "ticket",
  "workflow_data": {
    "nodes": [
      {
        "id": "trigger_1",
        "type": "trigger",
        "position": { "x": 100, "y": 100 },
        "data": {
          "label": "SLA ƒ∞hlali",
          "config": {
            "type": "sla_breach",
            "conditions": {
              "priority": "high"
            }
          }
        }
      },
      {
        "id": "condition_1",
        "type": "condition",
        "position": { "x": 300, "y": 100 },
        "data": {
          "label": "VIP M√º≈üteri mi?",
          "config": {
            "expression": "customer.type == 'vip'"
          }
        }
      },
      {
        "id": "action_1",
        "type": "action",
        "position": { "x": 500, "y": 50 },
        "data": {
          "label": "Y√∂neticiye Y√ºkselt",
          "config": {
            "type": "escalate",
            "escalation_level": "manager"
          }
        }
      },
      {
        "id": "action_2",
        "type": "action",
        "position": { "x": 500, "y": 150 },
        "data": {
          "label": "E-posta Bildirimi",
          "config": {
            "type": "send_email",
            "template": "sla_breach_notification"
          }
        }
      }
    ],
    "connections": [
      {
        "id": "conn_1",
        "source": "trigger_1",
        "target": "condition_1"
      },
      {
        "id": "conn_2",
        "source": "condition_1",
        "target": "action_1",
        "condition": "true"
      },
      {
        "id": "conn_3",
        "source": "condition_1",
        "target": "action_2",
        "condition": "false"
      }
    ]
  }
}
```

---

## üîß Geli≈ütirme

### Yeni Node Tipi Ekleme

#### 1. Node Tipi Tanƒ±mlama
```typescript
// workflow_node_types tablosuna ekle
const newNodeType = {
  name: 'Yeni Node',
  type: 'custom_action',
  icon: 'CustomIcon',
  description: '√ñzel aksiyon node\'u',
  config_schema: {
    properties: {
      custom_field: { type: 'string' }
    }
  }
};
```

#### 2. Bile≈üen Olu≈üturma
```typescript
// CustomNode.tsx
const CustomNode: React.FC<CustomNodeProps> = ({ data, config }) => {
  return (
    <div className="custom-node">
      <div className="node-header">{data.label}</div>
      <div className="node-content">
        {/* Node i√ßeriƒüi */}
      </div>
    </div>
  );
};
```

#### 3. ƒ∞≈üleyici Ekleme
```typescript
// Workflow executor'a ekle
const executeCustomAction = async (nodeConfig: any, context: any) => {
  // √ñzel aksiyon mantƒ±ƒüƒ±
  console.log('Custom action executed:', nodeConfig);
};
```

---

## üêõ Sorun Giderme

### Yaygƒ±n Sorunlar

#### 1. Migration Hatasƒ±
```bash
# Hata: Table already exists
# √á√∂z√ºm: Migration'ƒ± tekrar √ßalƒ±≈ütƒ±rƒ±n
npm run workflow-migration
```

#### 2. Node Baƒülantƒ± Hatasƒ±
```typescript
// Hata: Connection validation failed
// √á√∂z√ºm: Node tiplerini kontrol edin
const validConnections = {
  trigger: ['condition', 'action'],
  condition: ['action', 'approval'],
  action: ['condition', 'action', 'notification']
};
```

#### 3. Workflow √áalƒ±≈ütƒ±rma Hatasƒ±
```typescript
// Hata: Workflow execution failed
// √á√∂z√ºm: Execution loglarƒ±nƒ± kontrol edin
const checkExecutionLogs = async (executionId: string) => {
  const { data } = await supabase
    .from('workflow_executions')
    .select('*')
    .eq('id', executionId)
    .single();
  
  console.log('Execution logs:', data);
};
```

---

## üìû Destek

### Yardƒ±m Alma
- **GitHub Issues**: Proje repository'sinde issue a√ßƒ±n
- **Dok√ºmantasyon**: Bu README dosyasƒ±nƒ± g√ºncelleyin
- **Code Review**: Pull request ile katkƒ±da bulunun

### Katkƒ±da Bulunma
1. Fork yapƒ±n
2. Feature branch olu≈üturun
3. Deƒüi≈üikliklerinizi commit edin
4. Pull request g√∂nderin

---

## üéâ Sonu√ß

Workflow Builder sistemi, i≈ü s√ºre√ßlerini otomatikle≈ütirerek verimliliƒüi artƒ±rƒ±r ve insan hatalarƒ±nƒ± minimize eder. G√∂rsel aray√ºz√º sayesinde teknik bilgi gerektirmeden karma≈üƒ±k i≈ü akƒ±≈ülarƒ± olu≈üturulabilir.

**üéØ Ana Faydalar:**
- ‚ö° Hƒ±zlƒ± i≈ü akƒ±≈üƒ± olu≈üturma
- üîÑ Otomatik s√ºre√ß y√∂netimi
- üìä G√∂rsel s√ºre√ß takibi
- üé® Kullanƒ±cƒ± dostu aray√ºz
- üîß Esnek √∂zelle≈ütirme
- ÔøΩÔøΩ Performans artƒ±≈üƒ±
